# To execute this docker-compose yml file use `docker-compose -f docker-compose-v2.yml up`
# Add the `-d` flag at the end for detached execution
# To stop the execution, hit Ctrl+C, and then `docker-compose -f docker-compose-v2.yml down`
version: '2'
services:
  chrome:
    image: selenium/standalone-chrome:latest
    shm_size: 2gb
    ports:
      - "7900:7900" #Vnc port
      - "4444:4444" #Remote Driver port
      - "5900:5900" #Selenium Grid
    networks:
      automation_network:

#    depends_on:
#      - selenium-hub
#    environment:
#      - SE_EVENT_BUS_HOST=selenium-hub
#      - SE_EVENT_BUS_PUBLISH_PORT=4442
#      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
#    ports:
#      - "5900:5900"
#      - "4444:4444"
#      - "7900:7900"


#  edge:
#    image: selenium/node-edge:4.1.1-20211217
#    shm_size: 2gb
#    depends_on:
#      - selenium-hub
#    environment:
#      - SE_EVENT_BUS_HOST=selenium-hub
#      - SE_EVENT_BUS_PUBLISH_PORT=4442
#      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
#    ports:
#      - "6901:5900"
#
#  firefox:
#    image: selenium/node-firefox:4.1.1-20211217
#    shm_size: 2gb
#    depends_on:
#      - selenium-hub
#    environment:
#      - SE_EVENT_BUS_HOST=selenium-hub
#      - SE_EVENT_BUS_PUBLISH_PORT=4442
#      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
#    ports:
#      - "6902:5900"

#  selenium-hub:
#    image: selenium/hub:4.1.1-20211217
#
#    ports:
#      - "4442:4442"
#      - "4443:4443"
#      - "4444:4444"
  automation_tests_compose:
    image: mvelarde/automation_framework:latest
#    environment:
#      - "arg1=${arg1}"
    command: ./gradlew test -Dgroups=
#    build:
    networks:
      automation_network:
    depends_on:
      - chrome

#networks:
#  static-network:
#    ipam:
#      config:
#        - subnet: 172.20.0.0/16
#        - gateway: 172.20.0.2
#        - Driver:bridge
          #docker-compose v3+ do not use ip_range
#          ip_range: 172.20.0.2/24

networks:
  automation_network:
    ipam:
      driver: default
      config:
        - subnet: 172.20.0.0/16
          ip_range: 172.20.0.2/24
          gateway: 172.20.0.2